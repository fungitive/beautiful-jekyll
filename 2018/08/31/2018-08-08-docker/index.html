<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>docker三剑客compose、machine、swarm | 菲宇学堂-关注容器云及Linux运维</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="docker三剑客compose、machine、swarmdocker-compose   安装compose  curl -L https://github.com/docker/compose/releases/download/1.21.2/docker-compose-$(uname -s)-$(uname -m) -o /usr/local/bin/docker-compose  ch">
<meta name="keywords" content="docker">
<meta property="og:type" content="article">
<meta property="og:title" content="docker三剑客compose、machine、swarm">
<meta property="og:url" content="http://www.feiutech.cn/2018/08/31/2018-08-08-docker/index.html">
<meta property="og:site_name" content="菲宇学堂-关注容器云及Linux运维">
<meta property="og:description" content="docker三剑客compose、machine、swarmdocker-compose   安装compose  curl -L https://github.com/docker/compose/releases/download/1.21.2/docker-compose-$(uname -s)-$(uname -m) -o /usr/local/bin/docker-compose  ch">
<meta property="og:locale" content="zh-ch">
<meta property="og:updated_time" content="2018-09-01T02:47:44.707Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="docker三剑客compose、machine、swarm">
<meta name="twitter:description" content="docker三剑客compose、machine、swarmdocker-compose   安装compose  curl -L https://github.com/docker/compose/releases/download/1.21.2/docker-compose-$(uname -s)-$(uname -m) -o /usr/local/bin/docker-compose  ch">
  
    <link rel="alternate" href="/atom.xml" title="菲宇学堂-关注容器云及Linux运维" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">菲宇学堂-关注容器云及Linux运维</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">关注容器云及Linux运维</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/article">文章</a>
        
          <a class="main-nav-link" href="/categories">分类</a>
        
          <a class="main-nav-link" href="/tags">标签</a>
        
          <a class="main-nav-link" href="/archive">归档</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://www.feiutech.cn"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-2018-08-08-docker" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/31/2018-08-08-docker/" class="article-date">
  <time datetime="2018-08-31T09:43:00.000Z" itemprop="datePublished">2018-08-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/容器云/">容器云</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      docker三剑客compose、machine、swarm
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="docker三剑客compose、machine、swarm"><a href="#docker三剑客compose、machine、swarm" class="headerlink" title="docker三剑客compose、machine、swarm"></a>docker三剑客compose、machine、swarm</h4><h5 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h5><p>   安装compose</p>
<pre><code> curl -L https://github.com/docker/compose/releases/download/1.21.2/docker-compose-$(uname -s)-$(uname -m) -o /usr/local/bin/docker-compose

chmod +x /usr/local/bin/docker-compose
</code></pre><p>测试安装</p>
<pre><code>$ docker-compose --version
docker-compose version 1.21.2, build 1719ceb
</code></pre><p>常用命令</p>
<pre><code>命令:
build              Build or rebuild services
bundle             Generate a Docker bundle from the Compose file
config             Validate and view the Compose file
create             Create services
down               Stop and remove containers, networks, images, and volumes
events             Receive real time events from containers
exec               Execute a command in a running container
help               Get help on a command
images             List images
kill               Kill containers
logs               View output from containers
pause              Pause services
port               Print the public port for a port binding
ps                 List containers
pull               Pull service images
push               Push service images
restart            Restart services
rm                 Remove stopped containers
run                Run a one-off command
scale              Set number of containers for a service
start              Start services
stop               Stop services
top                Display the running processes
unpause            Unpause services
up                 Create and start containers
version            Show the Docker-Compose version information
</code></pre><p><a href="https://docs.docker.com/compose/overview/" target="_blank" rel="noopener">https://docs.docker.com/compose/overview/</a></p>
<h4 id="docker-machine"><a href="#docker-machine" class="headerlink" title="docker-machine"></a>docker-machine</h4><p>简介</p>
<p>docker-machine是安装docker环境的一个工具，可以在一台机器上通过命令控制几台机器安装docker环境，运行docker命令，创建docker swarm集群的工具。</p>
<p>安装</p>
<p>docker-machine和compose有点类似，都是一个可运行的linux二进制文件(下面都是基于linux版本做的)，下载下来这个文件后放到/usr/local/bin里面设置文件权限就可以直接使用了，docker-machine的github地址<a href="https://github.com/docker/machine" target="_blank" rel="noopener">https://github.com/docker/machine</a></p>
<pre><code>curl -L https://github.com/docker/machine/releases/download/v0.10.0/docker-machine-`uname -s`-`uname -m` &gt;/tmp/docker-machine &amp;&amp;
chmod +x /tmp/docker-machine &amp;&amp;
sudo cp /tmp/docker-machine /usr/local/bin/docker-machine
</code></pre><p>使用</p>
<p>按照docker-machine github上的介绍，它是一个简化Docker安装的命令行工具，通过一个简单的命令行即可在相应的平台上安装Docker，比如VirtualBox、 Digital Ocean、Microsoft Azure。根据他的描述和github上的例子可以看出他可以直接在指定平台上创建机器。</p>
<p>我们这里只测试已经创建好有ip的实体机或者虚拟机。docker-machine操作各个机器实际上用ssh无密码访问的，如果是在已经配置好ip的实体机或虚拟机上用就要手动或者使用脚本设置无密码访问了。</p>
<p>无密码访问<br>ssh-keygen #一直回车</p>
<p>ssh-copy-id <a href="mailto:root@192.168.1.28" target="_blank" rel="noopener">root@192.168.1.28</a> #ip为docker-machine要操作的机器，输入密码<br>上面结束之后，每台机器上还得安装net-tools,docker-machine会用到netstat命令来检测端口使用情况，如果机器上没有安装会报错。如果你确定那台机器上的端口没问题，即使报错也没问题，最终那台机器还是会加入到docker-machine的管理中。<br>yum install net-tools<br>连接机器<br>    docker-machine create -d generic –generic-ip-address=192.168.1.28 node28<br>    node28为给机器的别名<br>    -d generic驱动类型<br>    –generic-ip-address 要控制机器的ip，必须<br>    –generic-engine-port docker-engine的远程访问端口，默认为2376<br>    –generic-ssh-key 远程访问机器的私钥，默认使用.ssh/下面的私钥<br>    –generic-ssh-user 远程访问机器的用户名，默认为root<br>    –generic-ssh-port 远程ssh访问的端口，默认为22<br>    –engine-insecure-registry docker-engine的insecure-registry<br>    –engine-install-url 安装docker-engine的地址，默认为”<a href="https://get.docker.com”" target="_blank" rel="noopener">https://get.docker.com”</a><br>    –engine-registry-mirror docker-engine镜像的代理地址<br>上面的命令根据国内环境可以换为下面<br>    docker-machine create \<br>    -d generic \<br>    –generic-ip-address=192.168.1.28 \<br>    –engine-install-url=<a href="https://get.daocloud.io/docker/" target="_blank" rel="noopener">https://get.daocloud.io/docker/</a>   \<br>    –engine-registry-mirror=<a href="http://91c0cc1e.m.daocloud.io" target="_blank" rel="noopener">http://91c0cc1e.m.daocloud.io</a>  \<br>    node28<br>通过docker-machine连接了各个机器后，就可以通过docker-machine来操作各个机器了，更多命令查看 docker-machine –help<br><a href="https://docs.docker.com/machine/install-machine/" target="_blank" rel="noopener">https://docs.docker.com/machine/install-machine/</a><br><a href="https://blog.csdn.net/vchy_zhao/article/details/70238472" target="_blank" rel="noopener">https://blog.csdn.net/vchy_zhao/article/details/70238472</a></p>
<h4 id="swarm"><a href="#swarm" class="headerlink" title="swarm"></a>swarm</h4><h5 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h5><p>swarm从docker1.9版本开始就有了，但功能不完善、性能不稳定，一直不能登入生产环境，从1.12版本内置到了docker-engine中，可以直接使用docker swarm命令来操作swarm。</p>
<p>swarm是docker集群的资源管理工具。简单点理解，在很多台机器上部署docker，组成一个docker集群，并把整个集群的资源抽象成资源池，使用者部署docker应用的时候，只需要将应用交给swarm，swarm会根据整个集群资源的使用情况来分配资源给部署的docker应用，可以将这个集群的资源利用率达到最大。<br>类似的服务框架还有mesos+marathon，kubernetes。</p>
<p>①最早使用的是mesos+marathon那一套，优点是基于成熟的资源调度管理框架mesos，缺点是部署起来还是很麻烦的，像服务发现、负载均衡等概念在里面也都有，但都是碎片化以插件的形式存在，整个体系感觉不是很完善、不像一个整体。</p>
<p>②kubernetes从发布1.0版本以后在生产得到了很多实践，开始步入主流压过swarm和mesos+marathon，kubernetes针对docker应用集群的特点，概括出几个对象，pod、service、replication controller，pod为运行的基本单元，service则是专门来服务发现和服务代理的，replication controller 应用的副本做负载均衡。kubernetes就是一个很专业很全面完善的docker集群管理工具。</p>
<p>③swarm在很多方面很像kubernetes，不知道是不是偷偷抄袭的。swarm通过命令就可以很简单的在docker集群中创建应用设置副本数量，内置服务发现代理。swarm+compose≈kubernetes。swarm由于现在内置于docker中，使用部署更简单，功能上和kubernetes很相似，轻量级。</p>
<p>常用命令</p>
<pre><code>swarm init
swarm join
service create
service inspect
service ls
service rm
service scale
service ps
service update
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.feiutech.cn/2018/08/31/2018-08-08-docker/" data-id="cjlitybfr00030dpezzwtactz" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/">docker</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/08/31/hello-world/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Hello World
        
      </div>
    </a>
  
  
    <a href="/2018/08/31/2018-07-10-python-test/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Python运维常用的20个库和模块</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/容器云/">容器云</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/python/" style="font-size: 10px;">python</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/08/31/2018-07-10-Python-标准库/">(no title)</a>
          </li>
        
          <li>
            <a href="/2018/08/31/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2018/08/31/2018-08-08-docker/">docker三剑客compose、machine、swarm</a>
          </li>
        
          <li>
            <a href="/2018/08/31/2018-07-10-python-test/">Python运维常用的20个库和模块</a>
          </li>
        
          <li>
            <a href="/2018/08/31/docker/">docker</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 汪菲宇<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/article" class="mobile-nav-link">文章</a>
  
    <a href="/categories" class="mobile-nav-link">分类</a>
  
    <a href="/tags" class="mobile-nav-link">标签</a>
  
    <a href="/archive" class="mobile-nav-link">归档</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>